# 📋 配置覆盖功能说明

## 概述

CrossVerse Arena 实现了**三级配置 Fallback 机制**，允许在不同层级覆盖配置值：

```
关卡配置 (level_*.yaml) → 全局配置 (settings.yaml) → 硬编码默认值
```

这意味着每个关卡都可以自定义自己的游戏参数，无需修改全局配置或代码！

---

## 🎯 可覆盖的配置项

### 1️⃣ 角色选择限制 (`character_selection`)

控制玩家在开始游戏前可以选择的角色数量。

**全局默认值** (settings.yaml):
```yaml
gameplay:
  character_selection:
    min_characters: 1
    max_characters: 6
```

**关卡覆盖示例** (level_02.yaml):
```yaml
character_selection:
  min_characters: 2  # 必须至少选择2个角色
  max_characters: 3  # 最多只能选择3个（增加难度）
```

**效果对比**:
- **第一关**: 可以选择 1-6 个角色（使用全局默认值）
- **第二关**: 必须选择 2-3 个角色（关卡覆盖值）

---

### 2️⃣ 战场网格配置 (`battlefield`)

定义战场的网格布局和位置。

**全局默认值** (settings.yaml):
```yaml
gameplay:
  battlefield:
    grid_rows: 5       # 5行
    grid_cols: 9       # 9列
    cell_size: 80      # 单元格80像素
    grid_start_x: 100  # 起始X坐标
    grid_start_y: 150  # 起始Y坐标
```

**关卡覆盖示例** (level_02.yaml):
```yaml
battlefield:
  grid_rows: 3       # 只有3行（更紧凑）
  grid_cols: 7       # 7列（更短战线）
  cell_size: 90      # 更大的单元格
  grid_start_x: 150
  grid_start_y: 200
```

**效果对比**:
- **第一关**: 5×9 大网格，单元格80px（标准战场）
- **第二关**: 3×7 小网格，单元格90px（紧凑战场，更高难度）

---

### 3️⃣ 战斗系统配置 (`battle_system`)

控制战斗节奏和游戏难度。

**全局默认值** (settings.yaml):
```yaml
gameplay:
  battle_system:
    card_cooldown: 5.0              # 5秒卡片冷却
    enemy_attack_interval: 2.0      # 敌人2秒攻击一次
    base_damage_multiplier: 10      # 突破伤害10倍
    block_distance: 50              # 阻挡距离50像素
    default_enemy_speed: 20         # 敌人速度20
```

**关卡覆盖示例** (level_02.yaml):
```yaml
battle_system:
  card_cooldown: 3.0              # 3秒冷却（加快节奏）
  enemy_attack_interval: 1.5      # 敌人攻击更快
  base_damage_multiplier: 15      # 突破伤害更高
  block_distance: 60              # 更大的阻挡距离
  default_enemy_speed: 30         # 敌人速度更快
```

**效果对比**:
- **第一关**: 5秒冷却，敌人速度20，正常节奏（新手友好）
- **第二关**: 3秒冷却，敌人速度30，快节奏高难度（挑战关卡）

---

### 4️⃣ 经济系统配置 (`economy`)

控制金币数量和生成速率。

**全局默认值** (settings.yaml):
```yaml
gameplay:
  economy:
    default_initial_gold: 200
    default_gold_generation_rate: 25
    default_kill_reward: 25
```

**关卡覆盖示例** (level_01.yaml & level_02.yaml):
```yaml
# 第一关
economy:
  initial_gold: 200
  gold_generation_rate: 25
  kill_reward: 25

# 第二关
economy:
  initial_gold: 300              # 更多初始金币（补偿难度）
  gold_generation_rate: 30       # 更快的金币生成
  kill_reward: 30                # 更高的击杀奖励
```

**效果对比**:
- **第一关**: 200初始金币，25/秒生成（标准经济）
- **第二关**: 300初始金币，30/秒生成（宽松经济补偿高难度）

---

### 5️⃣ 基地配置 (`base`)

控制基地血量。

**关卡配置示例**:
```yaml
# 第一关
base:
  initial_hp: 1000
  max_hp: 1000

# 第二关
base:
  initial_hp: 800   # 更少的血量（增加难度）
  max_hp: 800
```

---

## 🔧 使用方法

### 1. 创建新关卡时

在 `campaigns/<campaign_id>/levels/level_XX.yaml` 中添加需要覆盖的配置项：

```yaml
level_id: "level_03"
name: "极限挑战"

# 只需添加想要覆盖的配置项
character_selection:
  max_characters: 2  # 只允许2个角色

battlefield:
  grid_rows: 2       # 极限2行网格

# 不写的配置项将使用全局默认值
```

### 2. 配置优先级

```
1. 关卡配置 (最高优先级)
   ↓ 未配置则查找
2. 全局配置 (settings.yaml)
   ↓ 未配置则使用
3. 硬编码默认值 (最低优先级)
```

### 3. 最佳实践

- ✅ **新手关卡**: 覆盖配置降低难度（更多金币、更慢敌人、更短冷却）
- ✅ **挑战关卡**: 覆盖配置增加难度（更少血量、更快敌人、更小网格）
- ✅ **特殊关卡**: 覆盖配置实现独特玩法（极限1行塔防、超多角色选择等）
- ❌ **不要修改**: 全局配置保持默认值，只在关卡中覆盖

---

## 📊 实际对比示例

### Level 01（新手教程）

使用全局默认配置：
- 角色选择: 1-6 个
- 网格大小: 5×9
- 卡片冷却: 5秒
- 敌人速度: 20
- 初始金币: 200

### Level 02（挑战关卡）

覆盖全局配置：
- 角色选择: 2-3 个 ⚡ **限制更严**
- 网格大小: 3×7 ⚡ **空间更小**
- 卡片冷却: 3秒 ⚡ **节奏更快**
- 敌人速度: 30 ⚡ **速度更快**
- 初始金币: 300 ✨ **补偿难度**

---

## 🎮 配置对游戏性的影响

| 配置项 | 增加值 → 效果 | 减少值 → 效果 |
|--------|--------------|--------------|
| `max_characters` | 更多选择，更简单 | 更少选择，更难 |
| `grid_rows` / `grid_cols` | 更大战场，更简单 | 更小战场，更难 |
| `card_cooldown` | 更慢节奏，更简单 | 更快节奏，需要快速反应 |
| `enemy_speed` | 敌人更快，更难 | 敌人更慢，更简单 |
| `base_damage_multiplier` | 突破惩罚更重，更难 | 突破惩罚更轻，更宽容 |
| `initial_gold` | 更多资源，更简单 | 更少资源，更难 |
| `base_hp` | 更多容错，更简单 | 更少容错，更难 |

---

## ✨ 优势

1. **灵活性**: 每个关卡都可以有独特的玩法体验
2. **无需改代码**: 完全通过配置文件实现
3. **易于平衡**: 快速调整关卡难度而不影响其他关卡
4. **可扩展性**: 未来可以添加更多可覆盖的配置项

---

## 📝 注意事项

- 所有覆盖配置项都是**可选的**
- 未配置的项会自动使用全局默认值
- 配置值会在游戏启动时验证，错误的配置会被忽略
- 支持热重载：修改配置后会在30秒内自动生效

---

**🎉 现在你可以为每个关卡创建独特的游戏体验，而无需修改任何代码！**
